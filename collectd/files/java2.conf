{%- from "collectd/map.jinja" import collectd_settings with context %}

#
# DO NOT EDIT
#
# This file is managed by salt via {{ source }}
# Modify the config that generates this file instead
#

{% set ind_increment = 2 %}

{%- macro scalar_value(value) -%}
    {%- if value in (False, True) -%}
{{ value | lower }}
    {%- elif value is number -%}
{{ value }}
    {%- elif value is string -%}
"{{ value }}"
    {%- else -%}
    {%- endif -%}
{%- endmacro -%}

{%- macro collectd(values, key='', ind=0, lb='\n', operator=' ') -%}
    {%- for value in values -%}
        {%- if value is number or value is string -%}
{{ lb }}{{ key | indent(ind, True) }}{{ operator }}{{ scalar_value(value) }}
        {%- elif value is mapping -%}
            {%- for k, v in value.items() -%}
                {%- if v is number or v is string -%}
{{ collectd([v], k, ind) }}
                {%- elif v | length() > 0 and (v[0] is number or v[0] is string) -%}
{{ lb }}{{ k | indent(ind, True) }}{{ collectd(v, '', 0, '', '') }}
                {%- else %}
{{ lb }}{{ ('<' ~ k ~ '>') | indent(ind, True) }}
{{- collectd(v, '', ind + ind_increment) }}
{{ ('</' ~ k.split(' ') | first ~ '>') | indent(ind, True) }}
                {%- endif -%}
            {%- endfor -%}
        {%- elif value is iterable -%}
{{ collectd(value, ind + ind_increment, operator) }}
        {%- endif -%}
    {%- endfor -%}
{%- endmacro -%}

{{ collectd(config) }}
